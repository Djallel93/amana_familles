{
	"openapi": "3.0.0",
	"info": {
		"title": "Family Management API",
		"description": "API de gestion des familles avec hi√©rarchie g√©ographique √† 3 niveaux (Ville > Secteur > Quartier)\n\n## üîê Authentification\n\nAucune authentification requise actuellement. L'API est accessible publiquement via l'URL de d√©ploiement Google Apps Script.\n\n## üåç Int√©gration GEO API v5.0\n\nCette API s'appuie sur la GEO API v5.0 pour la r√©solution de localisation hi√©rarchique.\n\n## üìä Hi√©rarchie G√©ographique\n\n- **Ville**: Niveau sup√©rieur (ex: Nantes)\n- **Secteur**: Niveau interm√©diaire (ex: Secteur Nord)\n- **Quartier**: Niveau inf√©rieur (ex: Centre Ville)\n\n## üìà Criticit√©\n\nLes familles sont √©valu√©es sur une √©chelle de 0 √† 5:\n- 0: Non √©valu√©\n- 1-2: Faible/Mod√©r√©e\n- 3: Moyenne\n- 4-5: Haute/Urgente",
		"version": "2.0.0",
		"contact": {
			"name": "API Support",
			"email": "support@example.com"
		}
	},
	"servers": [
		{
			"url": "https://script.google.com/macros/s/{DEPLOYMENT_ID}/exec",
			"description": "Production server",
			"variables": {
				"DEPLOYMENT_ID": {
					"default": "YOUR_DEPLOYMENT_ID",
					"description": "Google Apps Script deployment ID"
				}
			}
		}
	],
	"tags": [
		{
			"name": "Familles",
			"description": "Op√©rations sur les familles valid√©es"
		},
		{
			"name": "Filtres G√©ographiques",
			"description": "Filtrage par localisation (Ville, Secteur, Quartier)"
		},
		{
			"name": "Filtres Sp√©cifiques",
			"description": "Filtres par criticit√©, aide, mobilit√©"
		},
		{
			"name": "Utilitaires",
			"description": "Endpoints de test et maintenance"
		}
	],
	"paths": {
		"/": {
			"get": {
				"summary": "Endpoint principal",
				"description": "Point d'entr√©e de l'API - utilisez le param√®tre 'action' pour sp√©cifier l'op√©ration",
				"parameters": [
					{
						"name": "action",
						"in": "query",
						"required": true,
						"description": "Action √† effectuer",
						"schema": {
							"type": "string",
							"enum": [
								"ping",
								"allfamilies",
								"familybyid",
								"familyaddressbyid",
								"familieszakatfitr",
								"familiessadaka",
								"familiesbyquartier",
								"familiesbysecteur",
								"familiesbyville",
								"familiessedeplace",
								"familiesbycriticite"
							]
						}
					}
				],
				"responses": {
					"200": {
						"description": "Succ√®s"
					},
					"400": {
						"description": "Requ√™te invalide",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/Error"
								}
							}
						}
					}
				}
			}
		}
	},
	"components": {
		"schemas": {
			"Family": {
				"type": "object",
				"properties": {
					"id": {
						"type": "string",
						"description": "Identifiant unique de la famille",
						"example": "12345"
					},
					"nom": {
						"type": "string",
						"description": "Nom de famille",
						"example": "Dupont"
					},
					"prenom": {
						"type": "string",
						"description": "Pr√©nom de la personne de contact",
						"example": "Jean"
					},
					"zakatElFitr": {
						"type": "boolean",
						"description": "√âligible √† la Zakat El Fitr",
						"example": true
					},
					"sadaqa": {
						"type": "boolean",
						"description": "√âligible √† la Sadaqa",
						"example": true
					},
					"nombreAdulte": {
						"type": "integer",
						"description": "Nombre d'adultes dans le foyer",
						"example": 2,
						"minimum": 0
					},
					"nombreEnfant": {
						"type": "integer",
						"description": "Nombre d'enfants dans le foyer",
						"example": 3,
						"minimum": 0
					},
					"adresse": {
						"type": "string",
						"description": "Adresse compl√®te format√©e",
						"example": "10 rue de la Paix, 44000, Nantes"
					},
					"idVille": {
						"type": "string",
						"nullable": true,
						"description": "Identifiant de la ville (GEO API v5.0)",
						"example": "1"
					},
					"idSecteur": {
						"type": "string",
						"nullable": true,
						"description": "Identifiant du secteur (GEO API v5.0)",
						"example": "SEC_1"
					},
					"idQuartier": {
						"type": "string",
						"nullable": true,
						"description": "Identifiant du quartier (GEO API v5.0)",
						"example": "3"
					},
					"seDeplace": {
						"type": "boolean",
						"description": "La famille peut se d√©placer",
						"example": false
					},
					"email": {
						"type": "string",
						"format": "email",
						"nullable": true,
						"description": "Email de contact",
						"example": "jean.dupont@example.com"
					},
					"telephone": {
						"type": "string",
						"description": "T√©l√©phone principal (format: +33 (0) X XX XX XX XX)",
						"example": "+33 (0) 6 12 34 56 78"
					},
					"telephoneBis": {
						"type": "string",
						"nullable": true,
						"description": "T√©l√©phone secondaire",
						"example": "+33 (0) 6 98 76 54 32"
					},
					"circonstances": {
						"type": "string",
						"nullable": true,
						"description": "Description de la situation actuelle"
					},
					"ressentit": {
						"type": "string",
						"nullable": true,
						"description": "Notes ou observations"
					},
					"specificites": {
						"type": "string",
						"nullable": true,
						"description": "Besoins particuliers, allergies, etc."
					},
					"criticite": {
						"type": "integer",
						"description": "Niveau de criticit√© (0=non √©valu√©, 5=urgente)",
						"minimum": 0,
						"maximum": 5,
						"example": 3
					},
					"distance": {
						"type": "number",
						"nullable": true,
						"description": "Distance en km depuis le point de r√©f√©rence (si orderBy=distance)",
						"example": 5.2
					}
				},
				"required": [
					"id",
					"nom",
					"prenom",
					"nombreAdulte",
					"nombreEnfant",
					"telephone",
					"criticite"
				]
			},
			"FamilyAddress": {
				"type": "object",
				"properties": {
					"id": {
						"type": "string",
						"example": "12345"
					},
					"nom": {
						"type": "string",
						"example": "Dupont"
					},
					"prenom": {
						"type": "string",
						"example": "Jean"
					},
					"adresse": {
						"type": "string",
						"example": "10 rue de la Paix, 44000, Nantes"
					},
					"idVille": {
						"type": "string",
						"nullable": true,
						"example": "1"
					},
					"idSecteur": {
						"type": "string",
						"nullable": true,
						"example": "SEC_1"
					},
					"idQuartier": {
						"type": "string",
						"nullable": true,
						"example": "3"
					},
					"criticite": {
						"type": "integer",
						"example": 3
					}
				}
			},
			"FamilyListResponse": {
				"type": "object",
				"properties": {
					"count": {
						"type": "integer",
						"description": "Nombre de familles retourn√©es",
						"example": 150
					},
					"orderBy": {
						"type": "string",
						"description": "M√©thode de tri appliqu√©e",
						"enum": [
							"none",
							"criticite",
							"distance"
						],
						"example": "criticite"
					},
					"families": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/Family"
						}
					}
				}
			},
			"FilteredFamilyListResponse": {
				"type": "object",
				"properties": {
					"villeId": {
						"type": "string",
						"description": "ID de la ville filtr√©e (si applicable)"
					},
					"secteurId": {
						"type": "string",
						"description": "ID du secteur filtr√© (si applicable)"
					},
					"quartierId": {
						"type": "string",
						"description": "ID du quartier filtr√© (si applicable)"
					},
					"criticite": {
						"type": "integer",
						"description": "Niveau de criticit√© filtr√© (si applicable)"
					},
					"count": {
						"type": "integer",
						"description": "Nombre de familles retourn√©es"
					},
					"families": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/Family"
						}
					}
				}
			},
			"PingResponse": {
				"type": "object",
				"properties": {
					"status": {
						"type": "string",
						"example": "ok"
					},
					"message": {
						"type": "string",
						"example": "Famille API operational"
					},
					"version": {
						"type": "string",
						"example": "2.0"
					},
					"geoApiVersion": {
						"type": "string",
						"example": "5.0"
					},
					"timestamp": {
						"type": "string",
						"format": "date-time",
						"example": "2025-11-04T10:30:00.000Z"
					}
				}
			},
			"Error": {
				"type": "object",
				"properties": {
					"error": {
						"type": "string",
						"description": "Message d'erreur",
						"example": "Missing action parameter"
					}
				}
			}
		},
		"parameters": {
			"ActionParam": {
				"name": "action",
				"in": "query",
				"required": true,
				"description": "Action √† effectuer",
				"schema": {
					"type": "string"
				}
			},
			"OrderByParam": {
				"name": "orderBy",
				"in": "query",
				"required": false,
				"description": "M√©thode de tri",
				"schema": {
					"type": "string",
					"enum": [
						"criticite",
						"distance"
					]
				}
			},
			"LatParam": {
				"name": "lat",
				"in": "query",
				"required": false,
				"description": "Latitude du point de r√©f√©rence (requis si orderBy=distance)",
				"schema": {
					"type": "number",
					"format": "double",
					"example": 47.2173
				}
			},
			"LngParam": {
				"name": "lng",
				"in": "query",
				"required": false,
				"description": "Longitude du point de r√©f√©rence (requis si orderBy=distance)",
				"schema": {
					"type": "number",
					"format": "double",
					"example": -1.5536
				}
			}
		}
	}
}